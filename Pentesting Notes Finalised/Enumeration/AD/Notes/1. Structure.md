```
FOREST
│
└── TREE 1
│     ├── Domain: example.com
│     │       ├── OU: IT
│     │       ├── OU: HR
│     │       ├── OU: Servers
│     │       └── OU: Workstations
│     └── Child Domain: corp.example.com
│             └── OU: Finance
│
└── TREE 2
      └── Domain: business.local
            └── OU: Operations

```

# Structure 
## Main Key terms
Object
- Basic building block of AD
- eg. Users, Computers, Groups, Service Accounts, Group Policy Objects

Organisational Unit (OU)
- **Logical** grouping of objects inside a domain
- NOT security boundaries. 
- Used for delegation of adminitration
- Can be hierarchical

Domain
- Core security boundary in AD
- Like a company
	- Has domain name eg. corp.example.com
	- Has at least one Domain Controller (DC)
	- Has its own authentication policies
- Units of trust
	- Everything in domain shares same directory database

Tree
- One or more domains that share
	- Continuous namespace (same root name)
		- eg. `example.com` is the root domain, `corp.example.com` is child domain
	- Automatic 2 way transitive trust

Forest
- **Top level container** (only one) that holds
	- One or more trees
	- Global settings
	- Trust relatinoships
- True security boundary

## More structure terms
Container
- Hold other objects

Leaf
- Don't hold other objects

Attributes
- eg. Computer object has hostname, DNS name
- Have associated LDAP name used when performing LDAP queries

Global Unique Identifier (GUID)
- All objects in AD assigned a GUID, stored in ObjectGUID attribute

Security Principals
- Anything that the OS can authenticate
- eg. users, computer accounts..
- In AD, security principals manage access to other resources within the domain
	- Not only on the specific computer, since that is managed by SAM

Security Identifier (SID)
- Unique identifier for security principal/group

Distinguished Name (DN)
- Full path to object in AD
- eg. `inlanefreight.local/Employees/IT/BJones` -> `(cn=bjones, ou=IT, ou=Employees, dc=inlanefreight, dc=local)`
	- OUs and DCs are always written right-to-left (most specific → least specific)
	- So reverse the order (IT and Employees in this case)

Relative Distinguished Name (RDN)
- Distinguisher, but only at the current level in naming hierarchy (OU)
- From above, `bjones`

sAMAcountName
- User's logon name

userPrincipalName
- Attribute, another way to identify users in AD
- eg. `bjones@inlanefreight.local`
- Not mandatory

FSMO
- 5 roles that DC can have
	- Schema Master
	- Domain Naming Master
	- Relative ID (RID) Master
	- Primary Domain Controller (PDC) Emulator
	- Infrastructure Master

Global catalog
- Dc that stores copies of **ALL** objects in AD forest

Read-Only DC (RODC)
- Read only database

Replication
- AD objects updated and transferred from one DC to another

Service Principal Name (SPN)
- Uniquely identifies service instance

Group Policy Object (GPO)
- A **collection of policy settings** (security, scripts, restrictions).  
- Applied to:
	- Sites
	- Domains
	- OUs

Access Control Entry (ACE)
- Identifies a trustee (user account, gorup account, logon session ) and lists access rights for that trustee

Access Control LIst (ACL)
- Ordered collection of ACE that apply to an object

System Access Control Lists (SACL)
- Defines what access is logged in Security Event Log

FQDN (Fully Qualified DOmain Name)
- Full **DNS** name of a host (see notes on DNS)

Tombstone
- Like recycling bin, but missing attributes cannot be recovered

AD recycle bin
- Modern version of tombstone
- Preserves most attributes

SYSVOL
- Replicated folder on **ALL** DCs containing
	- GPO giles
	- Logon/logoff files
	- Public configuration files

AdminSDHolder
- Stores protected ACLs for **privileged groups** (eg. Domain admins)
- SDProp process runs on a schedule on the PDC Emulator DC (hourly by default)
	- Checks that correct ACL is applied to members of protected groups

dsHeuristics
- Forest wide configuration string
- Used to modify advanced AD behaviour including which groups are considered protected
- If group excluded via this attribute, changes that affect it will not be reverted when SDProp runs

adminCount
- Determines whether or not the SDProp process protects a user
	- 0 if unprotected else 1

DUC (Active Directory Users and Computers)
- GUI tool for managing normal AD tasks
	- Create users
	- Assign groups
	- Manage OUs
	- Edit attributes (limited)

ADSI Edit
- Low-level AD editor.
- Access to all attributes.
- Very powerful and dangerous — mistakes can break AD.

SIDHistory
- Stores previous SIDs from when an account was migrated.
- If not filtered correctly, attackers can abuse it to regain old privileged access.

NTDS.DIT
- The core AD database located at:
	- `C:\Windows\NTDS\NTDS.DIT
- Contains:
	- All AD objects
	- All password hashes
	- Group memberships
- Dumping this file = full domain compromise.

MSBROWSE
- Legacy protocol for announcing network resources on old Windows LANs.
- Effectively obsolete now.
- Previously used to find Master Browsers.


## Naming
## Hostname vs domain vs FQDN

These terms get mixed up a lot, so let’s be precise.
### 1️⃣ Hostname (short name)
`ACADEMY-EA-DC01`
- Name of the **machine itself**
- Unique **within the domain**

---
### 2️⃣ Domain name
`INLANEFREIGHT.LOCAL`
- The **Active Directory domain**
- Logical security boundary
- Note that AD chooses to use DNS as its naming system, so this is the same as the DNS domain name

---

### 3️⃣ Fully Qualified Domain Name (FQDN)
`ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL`
- Hostname + domain
- Globally unique **inside that DNS namespace**
