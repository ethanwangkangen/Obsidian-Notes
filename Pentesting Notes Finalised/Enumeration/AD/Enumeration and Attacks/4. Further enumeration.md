# Enumerating security controls

## Windows Defender
- `Get-MpComputerStatus` 
	- Look for RealTimeProtectionEnabled

## AppLocker
- Microsoft's whitelisting solution
- Common for cmd.exe and PowerShell.exe to be blocked, but can be bypassed
	- eg. PowerShell.exe can be blocked, but there are other PowerShell executable locations like `%SystemRoot%\SysWOW64\WindowsPowerShell\v1.0\powershell.exe` or `PowerShell_ISE.exe.`
- `Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections`

## PowerShell Constrained Language Mode
- Blocks many features needed to use PowerShell effectively
- `$ExecutionContext.SessionState.LanguageMode`

## LAPS
- Microsoft Local Administrator Password Solution
- Used to randomize and rotate local admin passwords on Windows hosts and prevent lateral movement
	- **local** admin, nothing to do with AD
	- Each local machine has an admin account (perhaps with the same name, eg. Administrator by default), but often in reality the same password is used for all admin accounts.
	- LAPS makes the passwords truly unique per machine.
		- Stores passwords in AD so only authorised users can read it
		- So and admin would have to query AD for the computer object, then read `ms-Mcs-AdmPwd` which would be the current local admin password. Then they would log into the local admin account with that password
- We can enumerate what domain users can read the LAPS password set for machines with LAPS installed and what machines do not have LAPS installed
- `Find-LAPSDelegatedGroups`
	- See which groups have bene delegated permission to read LAPS passwords
- `Find-AdmPwdExtendedRights`
	- Checks rights on each computer with LAPS enabled for any groups with read access and users with 'All Extended Rights'
		- The latter can read LAPS passwords, may be less protected
- `Get-LAPSComputers`
	- Search for computers that have LAPS enabled when passwords expire, and even the randomized passwords in cleartext if our user has access

# Credentialed Enumeration from Linux
- Already have foothold in domain, want to dig depeer
- Want info on
	- Domain user and compute attributes
	- Group membership
	- Group Policy Objects
	- ACLs
	- Trusts
	- ..
- But to use the tools below, need valid domain user credentials
	- So minimum need user's cleartext password, NTLM hash or SYSTEM access on domain-joined host

## CrackMapExec
- Can use with MSSQL, SMB, SSH, WinRM credentials
- Useful flags for now