- Important ports: 
	- 143 (connection to server) and 993 for IMAP
	- 110 and 995 for Pop3
	- 993 and 995 -> TLS/SSL to encrypt
	- Text-based commands in ASCII format
	- Encryption with SSL/TLS: standard port 143/alternative port eg. 993
- IMAP: online management of emails on server
- POP3: only provides listing, retrieving, deleting emails

# Internet Message Accesss Protocol / Post Office Protocol v3


| Protocol / Tool                 | Command / Syntax                                                      | Purpose / Notes                                                                            |
| ------------------------------- | --------------------------------------------------------------------- | ------------------------------------------------------------------------------------------ |
| **Nmap**                        | `nmap -p 110,143,993,995 <target>`                                    | Scan for POP3 (110/995 SSL) and IMAP (143/993 SSL) services.                               |
| **Nmap Scripts**                | `nmap --script=imap-capabilities -p 143 <target>`                     | Enumerate IMAP capabilities.                                                               |
|                                 | `nmap --script=pop3-capabilities -p 110 <target>`                     | Enumerate POP3 capabilities.                                                               |
|                                 | `nmap --script=imap-ntlm-info -p 143 <target>`                        | Extract NTLM info if supported.                                                            |
| **OpenSSL**                     | `openssl s_client -connect <target>:993` (can replace 993 with imaps) | Connect to IMAPS (SSL).                                                                    |
|                                 | `openssl s_client -connect <target>:995` (can replace 995 with pop3s) | Connect to POP3S (SSL).                                                                    |
| **Telnet / Netcat (Cleartext)** | `telnet <target> 143`                                                 | Connect to IMAP (cleartext).                                                               |
|                                 | `telnet <target> 110`                                                 | Connect to POP3 (cleartext).                                                               |
| **cURL**                        | `curl -k 'imaps://10.129.14.128' --user user:p4ssw0rd -v`             | Interact with IMAP/POP3                                                                    |
| **Basic IMAP Commands**         | `a login <username> <password>`                                       | Authenticate to IMAP. (`a` is a tag; any string works).                                    |
|                                 | `a list "" "*"`                                                       | List mailboxes/folders.                                                                    |
|                                 | `a create "inbox"`                                                    | Creates a mailbox with specified name                                                      |
|                                 | `a delete "inbox"`                                                    | Deletes mailbox                                                                            |
|                                 | `a rename "ToRead" "Important"`                                       | Rename                                                                                     |
|                                 | `a lsub "" * `                                                        | Return subset of names from set of names that User has declared as being active/subscribed |
|                                 | `a unselect INBOX`                                                    | Unselect inbox                                                                             |
|                                 | `a select INBOX`                                                      | Select the inbox.                                                                          |
|                                 | `a fetch 1 body[]`                                                    | Fetch the first email (full body).                                                         |
|                                 | `a fetch <ID> all`                                                    | Retrieve data associated with message in mailbox                                           |
|                                 | `a logout`                                                            | Exit IMAP session.                                                                         |
| **Basic POP3 Commands**         | `USER <username>`                                                     | Provide username.                                                                          |
|                                 | `PASS <password>`                                                     | Provide password.                                                                          |
|                                 | `STAT`                                                                | Get mailbox status (# messages, size).                                                     |
|                                 | `LIST`                                                                | List messages with sizes.                                                                  |
|                                 | `RETR 1`                                                              | Retrieve message 1.                                                                        |
|                                 | `QUIT`                                                                | Exit POP3 session.                                                                         |
|                                 | `CAPA`                                                                | Display server capabilities                                                                |
|                                 | `DELE 1`                                                              | Delete message 1.                                                                          |
| **Hydra (Brute Force)**         | `hydra -l <user> -P <wordlist> imap://<target>`                       | IMAP brute force.                                                                          |
|                                 | `hydra -l <user> -P <wordlist> pop3://<target>`                       | POP3 brute force.                                                                          |
|                                 |                                                                       |                                                                                            |
Dangerous Settings

| **Setting**               | **Description**                                                                           |
| ------------------------- | ----------------------------------------------------------------------------------------- |
| `auth_debug`              | Enables all authentication debug logging.                                                 |
| `auth_debug_passwords`    | This setting adjusts log verbosity, the submitted passwords, and the scheme gets logged.  |
| `auth_verbose`            | Logs unsuccessful authentication attempts and their reasons.                              |
| `auth_verbose_passwords`  | Passwords used for authentication are logged and can also be truncated.                   |
| `auth_anonymous_username` | This specifies the username to be used when logging in with the ANONYMOUS SASL mechanism. |

