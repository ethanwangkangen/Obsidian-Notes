How does a web proxy work
- Forward proxy
- In Firefox, setup a foxy proxy to 127.0.0.1 port 8080
	- This means, all outgoing traffic gets sent here, and all incoming traffic gets sent here too
	- Browser opens a TCP connection to proxy:8080

Tunnel VS MITM
- Tunnel: just relays encrypted bytes between client and server
	- eg. Browser sends `CONNECT example.com:443` to the proxy
	- The proxy opens a raw TCP pipe to `example.com:443`, then steps out of th eway
	- TLS handshake happends end-to-end between browser and example.com, proxy just serves to forward bytes
- MITM:
	- The proxy terminates TLS instead of passing through
	- Proxy presents its own generated certificate for `example.com` signed by custom root CA
	- Decrypts request, then opens second TLS session to real `example.com`, acting as client
	- There are 2 TLS handshakes, first client to proxy, then proxy to server

Relevance:
- For HTTP, everything is in plaintext, so there really is no difference between the above 
- For HTTPS, MITM allows rreading of requests/responses in the UI of Burp

Intercepting Responses (on top of Requests, as per usual)
- BurpSuite > Proxy > Intercept on
	- Intercept outgoing requests (POST, ..)
- Can also intercept incoming responses
	- Proxy > Proxy settings
		- Enable `Intercept Response` under `Response interception rules`
	- Request is for what client sends to server, Response is what server sends back
- Use case:
	- eg. Changing HTML of webpage, eg. form input type from 'number' to 'text', so we can input the command in the webpage directly

## Automatic modification
For Requests
- Proxy > Proxy settings > HTTP match and replace rules > ADD
	- HTTP Request Header
- Can use regex, eg.
	- Match: `^User-Agent.*$`
	- Replace: `User-Agent: Hackthebox agent
For responses
- Proxy > Proxy settings HTTP match and replace rules > ADD
	- HTTP Response body
- eg. 
	- Match: type="number"
	- Replace: type="text
		- (type is not syntax, this is literally the HTML)

## Repeating Requests
- Proxy History
	- Proxy > HTTP history


## Encoding/Decoding
- URL encode text in Burp Repeater:
	1. Select text and right click
	2. Select Convert Selection > URL > URL-encode key characters
	- Use when changing parameters in Proxy/repeater
		- Inspector panel shows decoded view
		- Raw shows actual `%xx

Also comes with a decoder tool, say when web applications send encoded data
- `Decoder`

## Proxying tools
- Proxychains
	1. Edit `/etc/proxychains.conf`
		- Comment out last line
		- Add `http 127.0.0.1 8080`
	- Can make use of the `-q` option
		- Suppress output of connectoin info to ocnsole
		- eg. 
		- `proxychains -q curl http://SERVER_IP:PORT`
- Metasploit
	- Within options of a module, 
		- `set PROXIES HTTP:127.0.0.:8080`