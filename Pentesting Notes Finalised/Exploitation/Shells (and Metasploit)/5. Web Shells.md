- Browser-based shaell session we can use to interact with underlying operating system of a web server
	- Most gained by uploading payload written in a web language on target server
	- Should give RCE capability within broswer

# Laudanum
- https://github.com/jbarcia/Web-Shells/tree/master/laudanum
- Repo of ready-made files that can be used to
	- Inject onto a victim and receive back access via reverse shell
	- run commands on victim host right from browser etc.

## Working with Laudanum
- `/usr/share/laudanum` directory
- For most files, can copy them and palce where needed on victim to run
- For specific files like shells, must edit file to insert attacking host IP address..
	- Read contents and comments

1. Move a copy for modification
	- `cp /usr/share/laudanum/aspx/shell.aspx /home/<user>/demo.aspx`
2. Adjust code
	- eg. add IP address to the allowedIps variable 
	- Might want to remove ASCII art and comments (in case these are signatured on and can alert defenders/AV)
3. Upload webshell
4. Navigate to it to execute
	- eg. file was uploaded to status.inlanefreight.local\\files\demo.aspx
		- will require browsing for the upload by using \ in path instead of / like normal
	- the browser sends a request which is what makes the web server execute the script


# Antak Webshell

## ASPX
- Active Server Page Extended (ASPX) - file type/extension written for Microsoft APSP.NET framework
- Web form pages can be generated for users to input data
- On server side, info converted into HTML
	- Take advantage of this: use ASPX-based we shell to control the underlying Windows OS

## Antak
- Web shell built in ASP.Net, included within Nishang project
- Nishang is Offensive PowerShell toolset
- File found in 
	- `/user/share/nishang/Antak-Webshell`

Steps 
1. Move copy for modification
	- `cp /usr/share/nishang/Antak-WebShell/antak.aspx /home/<user>/Upload.aspx
2. Adjust code
	- Set credentials for webshell (own credentials)
		- Any random thing, just so random people can't just stumble into using the shell
3. Upload webshell
4. Navigate to it to execute
5. Login with credentials set before
	- Now should see the Antak shell  window
6. Utilise PowerShell commands to navigate and take actions against the host

# PHP Web Shell
Example
- https://github.com/WhiteWinterWolf/wwwolf-php-webshell
- Example:
	- rConfig on WebsServer
	- Cannot just upload since rConfig checks for file types
		- Only allow image file types
	- Can bypass with Burp Suite
1. Burp Suite
	- Fill out proxy settings in browser's network settings menu
		- 127.0.0.1 for IP address
		- 8080 for port (so all requests pass through Burp)
2. Bypassing the `content-type` file restriction
	- Note: change the Form info NOT the HTTP request details!
	- Change to `image/gif` in this case


# Example given
- 3 hosts in subnet
	- Access to 172.16.0.0/23
- Host 1
	- 172.16.1.1:8080
- Host 2
	- blog.inlanefreight.local
- Host3
	- 172.16.1.13

Host discovery enumeration


Host 1
- Web browser enumeration
	- Apache tomcat
- Check /etc/hosts
	- see that this IP maps to status.inlanefreight.local
- Check status.inlanefreight.local
	- Microsoft Windows Server 2019  v10.0.17763
	- Able to upload .aspx file
- Upload Antak Webshell and navigate to status.inlanefreight.local/files/upload.aspx
- Got powershell
- dir 'C:\Shares'
- kiv: powershell commands

Host 2
- Only give vhost name blog.inlanefreight.local
	- Check /etc/hosts for the IP
- Nmap Scan
	- Just 22 (ssh) and 80 (http)
- Web browser enumeration
	- Check blog.inlanefreight.local
	- Found the vulnerability
	- Directory busting with gobuster
	- Found subdirectory with credentials
		- admin
		- admin123!@#
- Download and import the vulnerability into msf files
- `reload_all
- Search 'Lightweight Facebook-styled'
	- Look at code to fine the name
- run
- shell


Host 3
- Nmap scan: 
	- 80, 135, 139, 445, 47001
	- SSH, SMB
- Web browser enumeration
	- Found directory with upload
	- Tried aspx shell upload and worked!
		- But did not get administrator
- SMB - try eternal blue
	- Use 1 instead of 0?
		- kiv
	- hostname -I
		- 10.129.69.70 172.16.1.5 172.17.0.1 dead:beef::250:56ff:fe94:23a4 
	- had to set lhost to 172.16.1.5 instead of 10.129.69.70


# Key takewaways from example
- Vhost mapping
	- Remember to check/update /etc/hosts file
	- Web enumeration: check both the vhost and the IP in browser(may show diff things)
	- Directory brute force for more enumeration
- Web browser enumeration
	- Try default creds (google)
- Msfconsole
	- `reload_all`
	- Try different exploits (variants), sometimes one doesnt work
	- Watch out for which IP put as Lhosts
		- Might have multiple network interfaces/networks active
			- eg. might have public facing NIC and another internal IP
		- `ip -o addr show
			- show interfaces and where each IP lives
		- `ip route get <TARGET_IP>`
			- show which local IP the kernel will use to reach the target
		- eg. 
			- `ip route get 172.16.1.13
			- `172.16.1.13 dev ens224 src 172.16.1.5 uid 1001 
			- this shows that the 172.. ip is the one used to reach the target
			- makes sense, this is within the internal subnet of the lab
`
