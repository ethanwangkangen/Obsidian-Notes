# Local File Inclusion (LFI)
- Back end languages like PHP, JS, JAVA use HTTP parameters to specify what is shown on web page
	- Parameters used to specify which resource is shown on page
	- If functionalities not securely coded, attacker may manipulate parameters to display content of **any file** on **hosting** surver
- Most common place of LFI - templating engines
	- Page shows common stastic parts like header, navigation bar etc., then dynamically loads other content that changes between pages
	- eg. `/index.php?page=about`
		- `index.php` sets static content
		- then pulls dynamic content specified in paramter, in this case may be read from file called `about.php

## Vulnerable Code
- PHP include() function
eg.
```php
if (isset($_GET['language'])) {
    include($_GET['language']);
}
```

- Path passed to include() taken from user controlled parameter like GET
	- AND code does not **explicitly filter and sanitize the user input**
	- Here, `language` parameter directly passed to the include() function
	- So any path we set in the `language` paramter will bel oaded, included any local files on back end server
	- Not just `include()
		- `include_once()`, `require()`, `require_once()`, `file_get_contents()`

- NodeJS
```javascript
if(req.query.language) {
    fs.readFile(path.join(__dirname, req.query.language), function (err, data) {
        res.write(data);
    });
}
```

- Whatever parameter passed from URL gets used by the `readFile` function, which then write s the file content in HTTP response
- Another example: 
	- `render()
```javascript
app.get("/about/:language", function(req, res) {
    res.render(`/${req.params.language}/about.html`);
});
```

- Here, instead of GET parameter specified after ? character, this takes parameter from URL path (/about/en)

- Java
```jsp
<c:if test="${not empty param.language}">
    <jsp:include file="<%= request.getParameter('language') %>" />
</c:if>
```
- `include` function takes file/page URL as argument, renders object into front end template
```jsp
<c:import url= "<%= request.getParameter('language') %>"/>
```
- `import` also used to render local file or URL

- .NET
eg. 
```cs
@if (!string.IsNullOrEmpty(HttpContext.Request.Query['language'])) {
    <% Response.WriteFile("<% HttpContext.Request.Query['language'] %>"); %> 
}
```
- `Response.WriteFile` also takes file path for input, write content to response
```cs
@Html.Partial(HttpContext.Request.Query['language'])
```
- Similarly for `@Httml.Partial()`
```cs
<!--#include file="<% HttpContext.Request.Query['language'] %>"-->
```
- `Include` function too

**Some functions only read content of specified files while others also exectue them**
- Also, some allow specifying remote URLs while some only work with files local to back-end server

|**Function**|**Read Content**|**Execute**|**Remote URL**|
|---|:-:|:-:|:-:|
|**PHP**||||
|`include()`/`include_once()`|✅|✅|✅|
|`require()`/`require_once()`|✅|✅|❌|
|`file_get_contents()`|✅|❌|✅|
|`fopen()`/`file()`|✅|❌|❌|
|**NodeJS**||||
|`fs.readFile()`|✅|❌|❌|
|`fs.sendFile()`|✅|❌|❌|
|`res.render()`|✅|✅|❌|
|**Java**||||
|`include`|✅|❌|❌|
|`import`|✅|✅|✅|
|**.NET**||||
|`@Html.Partial()`|✅|❌|❌|
|`@Html.RemotePartial()`|✅|❌|✅|
|`Response.WriteFile()`|✅|❌|❌|
|`include`|✅|✅|✅|
