![[77.png]]

- Rpivot
	- Reverse SOCKS proxy tool
		- Reverse proxy just means the tunnel is established by the other machine connecting to us. So all the meterpreter methods are reverse proxies too since the shell is sent to us by the ubuntu machine and we listen.
	- A tunnel is established between our port 9999 and client.
	- A socks listener established on our port 9050, which will then forward SOCKS requests to the client end of the above tunnel.
	

Locally
1. Clone rpivot
	- `git clone https://github.com/klsecservices/rpivot.git`
2. Install Python 2.7
	- `sudo apt-get install python2.7`
3. Run server.py from attack host
	- `python2.7 server.py --proxy-port 9050 --server-port 9999 --server-ip 0.0.0.0`
		- Port 9999: Control channel (for client.py ie ubuntu machine to connect)
		- Port 9050: Socks proxy (for tools)
4. Transfer rpivot to target ubuntu machine
	- `scp -r rpivot ubuntu@<IpaddressOfTarget>:/home/ubuntu/`
		- or other methods
5. Configure proxychains to send to port 9050 on our machine
	- `vim /etc/proxychains.conf`
	-  add the line `socks5 127.0.0.1 9050`

Client
1. Run client.py from ubuntu machine
	- `python2.7 client.py --server-ip 10.10.14.18 --server-port 9999`
		- 10.10.14.18 is attack host IP

Local
1. Use proxychains to reach the internal network
	- `proxychains firefox-esr 172.16.5.135:80`


```
Firefox
 ↓
ProxyChains
 ↓
127.0.0.1:9050  (SOCKS proxy on attack host)
 ↓
rpivot server.py
 ↓
Reverse tunnel over port 9999
 ↓
rpivot client.py (on Ubuntu pivot)
 ↓
TCP connection from Ubuntu → 172.16.5.135:80
 ↓
Apache webserver responds
 ↑
Response travels back the same path

```

The SOCKS python server will send request to the already-established TCP session, ie. (client.py -> server.py:9999). Ie it will send to whatever is connected to port 9999.