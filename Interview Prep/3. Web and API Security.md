
# Must-know topics

## Cross-Site Request Forgery
- Vulnerability: Browser automatically sends cookies
- Attacker forces victim's browser to send unauthenticated request to a website where the victim is already logged in
- Conditions
	- User is authenticated, **session cookie** lives in browser
	- Websites accepts state-changing actions via **GET/POST**
	- Browser **auto-includes** cookies on request sent to bank.com
- Examples of attacks
	- Malicious page
		-  `<img src="https://bank.com/transfer?amount=5000&to=attacker" />
	- Hidden forms
- Mitigation
	- CSRF Token
		- Per session
		- Must be submitted with the request
		- **NOT** stored in cookie. Can live in page, as hidden form field, or some meta tag
		- Stored server-side or signed, attacker's page cannot read the value
	- SameSite Cookies
		- Browser will only include the cookie if the request **comes from** the same website, not on cross-site request
- Look for
	- State-changing requests
		- POST, PUT, DELETE, PATCH
			- eg. /change-email, /change-passwords
		- GET requests that modify state
		- API endpoints that alter data
	- Check if CSRF token exists
		- If it's stored in cookie, no protection 
	- Test token validation
		- Remove token, see if ok
	- Check if action works with GET instead of POST
	- Check Cookie attributes
		- If Same-Site=Lax or Strict: CSRF resilient even without token
		- If Same-Site=None: CSRF risk



## SQL injection (all types)    
- Classic / In Band - Attacker sees output directly
	- Union Based
		- `?id = 1 UNION select NULL, NULL-- `
		- Must match number of columns
	- Error based
		- `?id=1' AND (SELECT 1 FROM (SELECT COUNT(*), CONCAT((SELECT user()),0x7e,FLOOR(RAND()*2))x FROM information_schema.tables GROUP BY x)a)--
- Blind
	- Boolean blind
		- `?id=1 AND 1=1` -> page loads normally
		- `?id=1 AND 1=2`-> page behaviour changes
	- Time-based blind
		- `?id=1' AND IF(1=1, SLEEP(5), 0)--`
- How to test manually?
	- Enumerate injection points (with Burp) - Post, Get, JSon fields, Cookies
	- Test with common SQLi characters like `'`, `"")`, `--`
	- Check for behavioural differences with boolean tests, see if `ORDER BY` leaks number of columns

## Cross-Site Scripting XSS (stored/reflected/DOM)
- Injecting Javascript into victim browser
- Reflected
	- Payload reflected immediately in HTTP response
- Stored
	- Payload stored in backend (database, logs..)
	- Injected in comment fields, username fields, forms
- Dom-based
	- Client side vulnerability.
- Threats: session theft through stealing cookies
	- eg. Application uses cookies without HttpOnly -> XSS vulnerability, attacker directly exfiltrate cookies

## Server Side Request Forgery (SSRF)
- Attacker makes server issue HTTP requests to internal/external system
- eg, user uploads image by URL
	- Attacker sends `{"url": "http://169.254.169.254/latest/meta-data/iam/security-credentials/"}`
	- Server fetches it and returns AWS keys
- Testing
	- Replace URL input with internal IPs like `localhost`
	- Try DNS rebinding payloads
	- Try changing procol schemes
		- `file:///etc/passwd`


## Command injection
- User-supplied input passed directly to server-side OS command
	- eg. `; id`
- Bypasses
	- Globbing
		- id with quotes ` `
		- `$(id)`
	- Encoding 
		- `%3B%20id`
	- Breaking quotes
		- `" test" ; id "`
- Defences
	- Never concatenate user input into shell commands
	- Validate input -> eg. whitelist



##  Path traversal / LFI / RFI



## Authentication vulnerabilities
- Weak password security
	- eg. Brute forceable login pages, weak rate limiting 
- Broken Login logic
	- eg. boolean bypass, `password == true
- Insecure password reset
	- eg. Brute force OTP
- Misuse of JWT for authentication
	- eg. Using `none` algorithm, not verifying signature properly

## Session management
- Session fixation
	- Attacker sets session ID before login
		- ie. gives victim a link with preset session ID
- Session hijacking
	- Stealing active session tokens
		- eg. XSS steal cookies, insecure cookies


## Cookie security flags
- HTTPOnly
	- Prevents JavaScripts from accessing Cookies, stops XSS from stealing session tokens
- Secure
	- Only send cookies over HTTPS
	- Prevents interception via sniffing, MITM session hijacking
- SameSite
	- Defends against CSRF, restricts cookies from being sent cross-site


## API issues:
- Broken auth / no rate limiting
	- Can bruteforce passwords
- Mass assignment
	- API takes user supplied JSON and automatically maps it to an object
		- eg. adding "role": "admin"
- IDOR (Insecure Direct Object Reference)
	- Attacker guesses another user's ID or identifier
		- eg. `GET /api/users/5`, modify the 5 to a 6
- JWT vulnerabilities
	- `alg:none` bypass -> removes signature
	- Algo confusion: change algo from RS256 to HS256, Signs token using public key instead, server thinks signature is valid
		- RS is asym but HS is sym. Server stores the public key for verifying RS256 signature, but changing algo confuses server, making it treat public key as a shared secret
- Steps
	- Check authentication, authorisation, input validation, rate limiting, error handling
	- Fuzz parameters, check IDOR, mass assignment vulnarbilites
	- Test for SQLi/XSS/SSRF, replay requests
	- Test JWT security - none alg, weak secret, algo confusion
	- Test HTTP methods and see if unauthenticated requests still work

### Tools you MUST mention
- Burp Suite
- FFUF 
- SQLmap (but emphasise manual first)

### Typical Questions

**Q: Explain SQL injection. How do you test for it?**  
**Q: What is CSRF? How do you prevent it?**  
**Q: Explain XSS**
**Q: Explain SSRF**
**Q: How would you test an API endpoint?**  
**Q: What is IDOR? Give an example.**
**Q: Explain the HttpOnly, Secure, Samesite cookie settings and associated attacks**


## Case Study
1. **Map the application**
- Identify authentication, cart, product, payment flows
- Note all inputs: GET/POST, hidden fields, API endpoints

2. **Test authentication**
- Brute force protection    
- Password reset flows
- Session fixation
- Cookie flags

3. **Test authorisation**
- Check IDOR:  
    `/order?id=123 â†’ change to 124`
- Vertical privilege escalation

4. **Input validation**
- SQL injection
- XSS
- SSTI
- File uploads

5. **Business logic flaws**
- Discount abuse
- Tampering with price values

6. **Secure headers**
- CSP, HSTS, X-Frame-Options

7. **Reporting**
- Clear evidence
- Screenshots
- Recommendations
