### Must-know topics

## Domain, forest, OU
- Domain
	- Security and administrative boundary
	- Group objects which share a common directory database and domain policies
	- Unit for authentication and identity storage
	- Each has one or more Domain Controllers (DC) which host a writable copy of the domain's directory partition
- Forest
	- Top level container
	- Collection of one/more domains that share a single schema, configuration, global catalogue
- Organisational Unit
	- Logical container inside a domain
	- Organising objects for administrative delegation and applying group policy
	- Administrative boundary, NOT security boundary



## Kerberos authentication flow
1. **AS_REQ (Authentication Service Request)**
    - Client → KDC (DC): “I’m user `alice`, I want a Ticket-Granting Ticket (TGT).”
    - If _pre-auth_ required, client proves knowledge of password (timestamp encrypted with key derived from password) to prevent offline brute-force.
    
2. **AS_REP (Authentication Service Reply)**    
    - KDC → Client: returns a **TGT** (encrypted with the KDC’s secret) and a session key encrypted with a key derived from the user’s password (or for preauth, different exchange). Client uses its password-derived key to decrypt the session key and keep the TGT for later.
    
3. **TGS_REQ (Ticket-Granting Service Request)**    
    - Client → KDC: presents the TGT and asks for a **service ticket** for a specific SPN (Service Principal Name), e.g. `MSSQLSvc/sqlserver.example.com`. The request is encrypted using the TGT session key.
    
4. **TGS_REP (Ticket-Granting Service Reply)**    
    - KDC → Client: returns a service ticket encrypted with the _service account’s_ key (derived from its password), plus a service session key encrypted for the client.
    
5. **AP_REQ (Application Request)**    
    - Client → Service (server hosting SPN): sends the service ticket. The service decrypts the ticket with its own key and verifies the client.


## Kerberoasting
- Attacker requests Kerberos service tickets (TGS) for service accounts (accounts with SPN) then cracks the encrypted part offline to recover the **service account password**

## AS-REP roasting
- Some accounts have DONT_REQ_PREAUTH enabled, meaning during **AS-REP**, no need to prove knowledge of password
- Attacker makes AS-REP request **for those accounts**, receives AS_REP response which is encrypted with **password-derived key** which attacker can ccrack offline


## NTLM + hash-based attacks


- Common AD attack vectors:
    - Pass-the-hash
    - LLMNR poisoning
    - Misconfigured ACLs

### Tools
- BloodHound
- Impacket scripts
- Responder

### Typical Questions

**Q: How does Kerberos work?**  
**Q: Explain Kerberoasting.**  
**Q: What is LLMNR poisoning?**  
**Q: How would you escalate to Domain Admin?**


1. **Local enumeration**
- `whoami /priv`
- Installed software
- Saved credentials

2. **Network enumeration**
- `net user /domain`
- `net group "Domain Admins" /domain`

3. **Dump credentials**
- LSASS dump (if authorised)
- Mimikatz

4. **Kerberoasting / AS-REP**
- Request service tickets
- Offline brute-force

5. **BloodHound mapping**
- Identify privilege escalation paths

6. **Lateral movement**
- WinRM / PsExec

7. **Reporting**
- Document attack path
- Provide recommendations