Protocol that resolves domain names to Ip addresses.

Full DNS Resolution process:
- Check `/etc/hosts`
	- Static local mapping. Even before the local cache
- Then check Local DNS Cache (stored in OS or browser cche)
- Then ask the OS-configured DNS resolver 
	- OS sends query to configured DNS resolver (usually ISP's or public one like 8.8.8.8)
		- this is what is in `/etc/resolv.conf`
- Then recursive Resolution begins
	- a. root server
		- 13 main root servers globally, respond with IP of the TLD server (eg. .com nameserver)
	- b. TLD server (top level domain)
		- returns the IP of the authoritative nameserver for google.come
	- c. authoritative DNS server
		- returns the actual A record (IP address) of google.com

| **Record Type** | **Meaning**                       | **Example**                                |
| --------------- | --------------------------------- | ------------------------------------------ |
| A               | Maps domain to IPv4               | `google.com → 142.250.190.36`              |
| AAAA            | Maps to IPv6                      | `google.com → 2607:f8b0:4005:...`          |
| CNAME           | Canonical name (alias)            | `www.example.com → example.com`            |
| MX              | Mail Exchange                     | `example.com → mail1.example.com`          |
| NS              | Name Servers                      | `example.com → ns1.dnsprovider.com`        |
| TXT             | Misc. text data (e.g., SPF, DKIM) | Used in email security                     |
| PTR             | Reverse lookup (IP → domain)      | `36.190.250.142.in-addr.arpa → google.com` |
| SOA             | Start of Authority                | Info about a DNS zone                      |
FQDN:
`<hostname>.<subdomain>.<second-level domain>.<top level domain>`

DNS usually unencrypted
- over port 53
- anyone on network path (ISP, wifi hotspot etc.) can see which domains are queried, and potentially modify or block the response


Options for encrypting DNS:

| Protocol                 | Transport   | Port | Description                                                      |
| ------------------------ | ----------- | ---- | ---------------------------------------------------------------- |
| **DNS over HTTPS (DoH)** | HTTPS (TCP) | 443  | DNS queries are sent as HTTPS requests (just like browsing).     |
| **DNS over TLS (DoT)**   | TLS (TCP)   | 853  | Encrypted version of DNS using its own port.                     |
| **DoQ (DNS over QUIC)**  | QUIC (UDP)  | 8853 | Fast, encrypted DNS using QUIC. Newer and less widely supported. |
# Zone
- Distinct part of domain namsespace that a specific entity/admin manages
- Zone file
	- text file that resides on DNS server
	- defines resource records withtin the zone, provides info on translating domain name into IP
# Relevant Commands

- dig
	- dig google.com
	- to see A record,
		- dig google.com ANY (IPv4 address)
	- to see full recursive resolution
		- dig +trace google.com
- nslookup
	- nslookup google.com
- host
	- host google.com
- cat /etc/resolv.conf
	- see which dns servers system is using
	- nameserver = DNS resolver
		- if see 127.0.0.53, this is actually pointing to **local stub resolver**
		- this means that the local DNS client (a stub resolver) is listening on 127.0.0.53, is part of systemd-resolved.
		- when app asks for example.com, is calls the OS stub resolver, which sends the request to 127.0.0.53. 
		- `systemd-resolved` receives it and checks its configured upstream DNS servers
		- then contacts a real DNS resolver (eg. 1.1.1.1) on your behalf
		- receives result and passes it back to app
- systemd-resolve / resolvectl
	- resolvectl query www.google.com
	- resolvectl status -> to see the actual DNS resolvers being used
- tcpdump for DNS
	- capture DNS traffic for port 53
	- sudo tcpdump -i any port 53

|Tool|Key Features|Use Cases|
|---|---|---|
|`dig`|Versatile DNS lookup tool that supports various query types (A, MX, NS, TXT, etc.) and detailed output.|Manual DNS queries, zone transfers (if allowed), troubleshooting DNS issues, and in-depth analysis of DNS records.|
|`nslookup`|Simpler DNS lookup tool, primarily for A, AAAA, and MX records.|Basic DNS queries, quick checks of domain resolution and mail server records.|
|`host`|Streamlined DNS lookup tool with concise output.|Quick checks of A, AAAA, and MX records.|
|`dnsenum`|Automated DNS enumeration tool, dictionary attacks, brute-forcing, zone transfers (if allowed).|Discovering subdomains and gathering DNS information efficiently.|
|`fierce`|DNS reconnaissance and subdomain enumeration tool with recursive search and wildcard detection.|User-friendly interface for DNS reconnaissance, identifying subdomains and potential targets.|
|`dnsrecon`|Combines multiple DNS reconnaissance techniques and supports various output formats.|Comprehensive DNS enumeration, identifying subdomains, and gathering DNS records for further analysis.|
|`theHarvester`|OSINT tool that gathers information from various sources, including DNS records (email addresses).|Collecting email addresses, employee information, and other data associated with a domain from multiple sources.|
|`Online DNS Lookup Services`|User-friendly interfaces for performing DNS lookups.|Quick and easy DNS lookups, convenient when command-line tools are not available, checking for domain availability or basic information|