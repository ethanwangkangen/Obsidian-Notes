# SMPT
Simple Mail Transfer Protocol
- Important ports: 25, 587
- Unencrypted. Can use wit SSL/TLS, port other than 25 is used for encrypted connection.

Authentication
- Preventing unauthorized users sending emails
- Extension: ESMPT with SMPT-Auth
- KIV: Open Relay Attack?

Workflow
1. **MUA (Mail User Agent)** → sends email to **MSA (Mail Submission Agent)**
2. **MSA / Relay server** → validates the sender and checks for spam
3. **MTA (Mail Transfer Agent)** → forwards email using DNS MX records
4. **MDA (Mail Delivery Agent)** → delivers email to recipient mailbox
5. **Mailbox** → user retrieves via POP3/IMAP

Enumeration:
- Banner grabbing with nmap
	- -sV
- User enumeration
	- Using `VRFY <username>` can show existing users
- Open relay testing
	- Open relay allows anyone to send emails via the server without authentication
	- `nmap--script smtp-open-relay`
# Imap/pop3
- Important ports: 
	- 143 (connection to server) and 993 for IMAP
	- 110 and 995 for Pop3
	- 993 and 995 -> TLS/SSL to encrypt
	- Text-based commands in ASCII format
	- Encryption with SSL/TLS: standard port 143/alternative port eg. 993
- IMAP: online management of emails on server
- POP3: only provides listing, retrieving, deleting emails


Dangerous Settings

| **Setting**               | **Description**                                                                           |
| ------------------------- | ----------------------------------------------------------------------------------------- |
| `auth_debug`              | Enables all authentication debug logging.                                                 |
| `auth_debug_passwords`    | This setting adjusts log verbosity, the submitted passwords, and the scheme gets logged.  |
| `auth_verbose`            | Logs unsuccessful authentication attempts and their reasons.                              |
| `auth_verbose_passwords`  | Passwords used for authentication are logged and can also be truncated.                   |
| `auth_anonymous_username` | This specifies the username to be used when logging in with the ANONYMOUS SASL mechanism. |

# SNMP
- Important ports: UDP 161, 162 
	- Control commnds using agents over 161
		- Client actively requests info from server
		- But also allows "traps" over 162 -> data packets sent from SNMP server to client without requests
- Simple Network Management Protocol
	- Monitor network devices
- MIB
	- Management Information Base
	- Format for storing device info
	- Text file, where all queryable SNMP objects of a device are listed in a tree hierarchy
	- At least one Object Identifier (OID), which provides necessary unique address and name, and also other info 
		- Each OID is a node in hierarchical namespace
- SNMP Versions
	- SNMPv1 - No built in authentication
		- No encryption support
	- SNMPv2
		- The community string that provides security is only transmitted in plain text, thus no built-in encryption
	- SNMPv3
		- Authentication with username and password
		- Transmission encryption with pre-shared key
- Community strings
	- Can be seen as passwords, determining if requested info can be seen 
- Default config
	- `cat /etc/snmp/snmpd.conf | grep -v "#" | sed -r '/^\s*$/d'`

Dangerous settings

| **Settings**                                     | **Description**                                                                       |
| ------------------------------------------------ | ------------------------------------------------------------------------------------- |
| `rwuser noauth`                                  | Provides access to the full OID tree without authentication.                          |
| `rwcommunity <community string> <IPv4 address>`  | Provides access to the full OID tree regardless of where the requests were sent from. |
| `rwcommunity6 <community string> <IPv6 address>` | Same access as with `rwcommunity` with the difference of using IPv6.                  |
Tools
- snmpwalk
	- query OIDs and information
	- `snmpwalk -v2c -c public 10.129.14.128`
		- public being the community string
- onesixtyone
	- brute force names of community strings
	- `sudo apt install onesixtyone`
	- `onesixtyone -c /opt/useful/seclists/Discovery/SNMP/snmp.txt 10.129.14.128`
- braa
	- `sudo apt install braa`
	- `braa <community string>@<IP>:.1.3.6.*   # Syntax
	- `braa public@10.129.14.128:.1.3.6.*`


# MySQL
- Important ports:
	- usually port 3306
- Relational Database Management system
- SQL database language
- Usually combined with Linux OS, PHP, Apache web server
	- LAMP (Linux, Apache, MySQL, PHP)
- Sensitive data like passwords can be stored in plain-text form, but usually encrypted beforehand by PHP scripts using secure methods like One-Way-Encryption

Default config
- `sudo apt install mysql-server -y`
- `cat /etc/mysql/mysql.conf.d/mysqld.cnf | grep -v "#" | sed -r '/^\s*$/d'`

Main security-relevant options

|**Settings**|**Description**|
|---|---|
|`user`|Sets which user the MySQL service will run as.|
|`password`|Sets the password for the MySQL user.|
|`admin_address`|The IP address on which to listen for TCP/IP connections on the administrative network interface.|
|`debug`|This variable indicates the current debugging settings|
|`sql_warnings`|This variable controls whether single-row INSERT statements produce an information string if warnings occur.|
|`secure_file_priv`|This variable is used to limit the effect of data import and export operations.|
Interaction
- `mysql -u root -h IP`
	- For passwordless login
- `mysql -u root -pP4ssword -h ip`

Databases
- Important ones are 
	- system schema (sys)
		- tables, info, metadata necessary for management
	- information schema (information_schema)
		- also metadata, but mainly retrieved from system schema database


# MSSQL
- Important ports
	- 1433
- Microsoft SQL
- Sql Server Management Studio (SMSS)
	- Feature, can instsall separately or come with MSSQL
	- Commonly on server for initial configuration and long-term management of databases by admins
	- Client-side application, can be used on **any** system an admin is planning to manage db form
		- Not only on server hosting db
- Other clients can be used to access a database running MSSQL
	- mssql-cli
	- SQL server powershell
	- HeidiSQL
	- SQLPro
	- Impacket's mssqlclient.py
		- Most useful
		- `locate mssqlclient`



Default databases

|Default System Database|Description|
|---|---|
|`master`|Tracks all system information for an SQL server instance|
|`model`|Template database that acts as a structure for every new database created. Any setting changed in the model database will be reflected in any new database created after changes to the model database|
|`msdb`|The SQL Server Agent uses this database to schedule jobs & alerts|
|`tempdb`|Stores temporary objects|
|`resource`|Read-only database containing system objects included with SQL server|


Default configuration
- When admin installs MSSQL to be network accessible, SQL service likely runs as NT SERVICE\MSSQLSERVER
- Connecting from client side possible through Windows Authenticaoitn
	- By default, encryption not enforced when trying to ocnnect
	- Windows authentication -> Windows OS processes login requests, uses either local SAM database/domain controller hosting **Active Directory** before allowing connectivity to database management system

Dangerous settings
- MSSQL clients not using encryption to connect to the MSSQL server
- The use of self-signed certificates when encryption is being used. It is possible to spoof self-signed certificates
- The use of [named pipes](https://docs.microsoft.com/en-us/sql/tools/configuration-manager/named-pipes-properties?view=sql-server-ver15)
- Weak & default `sa` credentials. Admins may forget to disable this account

Nmap scan
- `sudo nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER -sV -p 1433 10.129.201.248`
	- mssql.username=sa -> guessed, default
	- no password

Metasploit
- mssql_ping

Mssqlclient.py
- If have credentials (guessed or gained access), can remotely connect to MSSQL server and start interacting with databases using T-SQL (Transact-SQL)
- `locate mssqlclient`
- `python3 mssqlclient.py Administrator@10.129.201.248 -windows-auth`
- If got password
	- Input after being prompetd


# Oracle TNS
- Important ports
	- Default: listens on 1521 (but can be changed)
- Oracle Transparent Network Substrate (TNS) 
- Supports various networking protocols betwene Oracle databases and client applications, eg. IPX/SPX and TCP/IP protocol stacks
	- Used to manages large complex databases
	- Built in encryption
- Is a bit like DNS + connection negotiation for Oracle.
	- Client asks for ORCL, TNS figures out the 'address' and 'service' to reach it, then establishes the session.

Default config
- Security features
	- Listener only accept connections from authorized hosts
	- Performs basic authentication using combination of hostnames, IP addresses, usernames, passwords
	- Oracle Net Services to encrypt communication between client and server
	- Config files: `tnsnames.ora, listener.ora`
		- `tnsnames.ora` - each database/service has unique entry in here.
			- client-side Oracle Net Services use this flie to resolve service names to network addresses
		- `listner.ora` - server side  config that defines listener's properties and parameters
			- listener uses this to determine the services it should listen to, and behaviour of listener
	- In $ORACLE_HOME/network/admin directory
- Often used with other Oracle services like Oracle DBSNMP,...
	- Oracle DBSNMP **default password** -> **dbsnmp**
	- Many orgs still use the *finger* service with Oracle -> vulnerable

- Oracle databases can be protected by using PL/SQL Exclusion List, PlsqlExclusionlist.
	- User-created text file, inside $ORACLE_HOME/sqldeveloper directory

|**Setting**|**Description**|
|---|---|
|`DESCRIPTION`|A descriptor that provides a name for the database and its connection type.|
|`ADDRESS`|The network address of the database, which includes the hostname and port number.|
|`PROTOCOL`|The network protocol used for communication with the server|
|`PORT`|The port number used for communication with the server|
|`CONNECT_DATA`|Specifies the attributes of the connection, such as the service name or SID, protocol, and database instance identifier.|
|`INSTANCE_NAME`|The name of the database instance the client wants to connect.|
|`SERVICE_NAME`|The name of the service that the client wants to connect to.|
|`SERVER`|The type of server used for the database connection, such as dedicated or shared.|
|`USER`|The username used to authenticate with the database server.|
|`PASSWORD`|The password used to authenticate with the database server.|
|`SECURITY`|The type of security for the connection.|
|`VALIDATE_CERT`|Whether to validate the certificate using SSL/TLS.|
|`SSL_VERSION`|The version of SSL/TLS to use for the connection.|
|`CONNECT_TIMEOUT`|The time limit in seconds for the client to establish a connection to the database.|
|`RECEIVE_TIMEOUT`|The time limit in seconds for the client to receive a response from the database.|
|`SEND_TIMEOUT`|The time limit in seconds for the client to send a request to the database.|
|`SQLNET.EXPIRE_TIME`|The time limit in seconds for the client to detect a connection has failed.|
|`TRACE_LEVEL`|The level of tracing for the database connection.|
|`TRACE_DIRECTORY`|The directory where the trace files are stored.|
|`TRACE_FILE_NAME`|The name of the trace file.|
|`LOG_FILE`|The file where the log information is stored.|



Setup:
```c
wget https://download.oracle.com/otn_software/linux/instantclient/214000/instantclient-basic-linux.x64-21.4.0.0.0dbru.zip
wget https://download.oracle.com/otn_software/linux/instantclient/214000/instantclient-sqlplus-linux.x64-21.4.0.0.0dbru.zip
sudo mkdir -p /opt/oracle
sudo unzip -d /opt/oracle instantclient-basic-linux.x64-21.4.0.0.0dbru.zip
sudo unzip -d /opt/oracle instantclient-sqlplus-linux.x64-21.4.0.0.0dbru.zip
export LD_LIBRARY_PATH=/opt/oracle/instantclient_21_4:$LD_LIBRARY_PATH
export PATH=$LD_LIBRARY_PATH:$PATH
source ~/.bashrc
cd ~
git clone https://github.com/quentinhardy/odat.git
cd odat/
pip install python-libnmap
git submodule init
git submodule update
pip3 install cx_Oracle
sudo apt-get install python3-scapy -y
sudo pip3 install colorlog termcolor passlib python-libnmap
sudo apt-get install build-essential libgmp-dev -y
pip3 install pycryptodome

```

Odat
- Oracle Database Attacking Tool 
	- `./odat.py -h` to check if installed

SIDs
- In Oracle Relational Database Management Systems (RDBMS), SID is a unique name that identifies particular database **instance**
	- Instance: set of processes and memory structures that interact to manage database's data
- When client connects to Oracle database, specifies database's SID, with connection string
	- If no SID specified, default value in `tnsnames.ora` used
- SID bruteforcing
	- `nmap p1521 -sV 10.129.204.235 --open --script oracle-sid-brute`
	- `./odat.py all -s 10.129.204.235`
		- odat scans may retrieve database names, versions, running processes, user accounts, vulnerabilities, misconfiguraitons, etc.
		- may find valid credentials -> can log in

Logging in
- sqlplus
	- `sqlplus scott/tiger@10.129.204.235/[SID]`
	- if get error: sqlplus: error while loading shared libraries: libsqlplus.so
		- `sudo sh -c "echo /usr/lib/oracle/12.2/client64/lib > /etc/ld.so.conf.d/oracle-instantclient.conf";sudo ldconfig`
	- can try logging in as System Database Admin
		- `sqlplus scott/tiger@10.129.204.235/[SID] as sysdba`
	- extract password hashes
		- `select name, password from sys.user$;`
	- Uploading web shell to target
		- requires server to run a web server, and need to know exact location of root directory of webserver
			- can try default paths
				- Linux: /var/www/html
				- Windows: C:\inetpub\wwwroot
	- File upload
		- `echo "Oracle File Upload Test" > testing.txt`
		- `./odat.py utlfile -s 10.129.204.235 -d XE -U scott -P tiger --sysdba --putFile C:\\inetpub\\wwwroot testing.txt ./testing.txt
		- Can test if file upload approach worked with curl
			- `curl -X GET http://10.129.204.235/testing.txt`
`

# IPMI
- Important ports
	- UDP 623
- Intelligent Platform Management Interface (IPMI)
- Gives administrators remote hardware-level control and monitoring independent of host OS - power on/off, hardware sensors, remote console...
	- Via dedicated Baseboard Management Controller (BMC)
		- BMCs usually built into many motherboards, but can also be added to system as a PCI card
		- Servers either come with BMC or support adding a BMC
	- If can access BMC, gain full access to host motherboard. Can monitor, reboot, power off, reinstall host OS...


Footprinting
- Nmap
	- `sudo nmap -sU --script ipmi-version -p 623 ip
- Metasploit
	- `use auxiliary/scanner/ipmi/ipmi_version` 


BMCs with default passwords:

|Product|Username|Password|
|---|---|---|
|Dell iDRAC|root|calvin|
|HP iLO|Administrator|randomized 8-character string consisting of numbers and uppercase letters|
|Supermicro IPMI|ADMIN|ADMIN|


Dangerous settings
- flaw in the RAKP protocol in IMPI 2.0
- during authentication, server sends a salted SHA1/MD5 hash of user's pw to client before authentication takes place
- can be leveraged to obtain the pw hash for ANY valid user account on BMC
- hashes can then be cracked using dictionary attack
	- **Hashcat, mode 7300**
- HP iLO using default factory password
	- `hashcat -m 7300 ipmi.txt -a 3 ?1?1?1?1?1?1?1?1 -1 ?d?u 
		- Tries all combinations of upper case letters and numbers for an eight-character password

Importance
- Can gain access to BMC web console 
- Instances where password is later re-used in other systems

Retrieving IMPI hashes
- Metasploit IPMI 2.0 RAKP Remote SHA1 Password Hash Retrieval
- `use auxiliary/scanner/ipmi/ipmi_dumphashes 
	- Note: experiment with different word lists

KIV: IMPI and hashcat cheatsheets
















































