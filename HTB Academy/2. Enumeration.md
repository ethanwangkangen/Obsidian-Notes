
# Nmap

Techniques:
- nmap --help

## Host discovery
- to see which systems are online
- scan network range
	- `sudo nmap 10.129.2.0/24 -sn -oA tnet | grep for | cut -d" " -f5`
	- -sN: no port scanning
	- -oA tnet: stores results inall formats starting with the name tnet
- scan ip list
	- eg. if given a list of hosts in a file caled hosts.lst
	- `sudo nmap -sn -oA tnet -iL hosts.lst | grep for | cut -d" " -f5`
- scan multiple ips
	- `sudo nmap -sn -oA tnet 10.129.2.18 10.129.2.19 10.129.2.20| grep for | cut -d" " -f5`
	- can specify a range too
		- `sudo nmap -sn -oA tnet 10.129.2.18-20| grep for | cut -d" " -f5`
- scan single ip
	- `sudo nmap 10.129.2.18 -sn -oA host` 
	- If we disable port scan (-sn), Nmap auto ping scan with ICMP echo requests
		- usually expect icmp reply if pinging host is alive
		- can manually send icmp echo requests with `-PE`
	- `--packet-trace` to see packet traces -> see ARP pings and replies
	- `--disable-arp-ping` to disable arp pings
	- `--reason` to see reason why Nmap marked our target as 'alive'
	- can get clues to system, eg. ttl from icmp requests (-PE) show ttl, which are operating-system specific

## Host and Port scanning
- 6 states:
	- Open
	- Closed (TCP protocol indicates packet received contains RST falg)
	- Filtered (no info/error code, can't determine)
	- Unfiltered (accessible but don't know if closed or open)
	- Open | Filtered (no response, firewall or packet may protect it)
	- Closed | Fitlered (Only in Ip ID idle scans, impossible to determine if closed or filtered by firewall)
- Flags
	- `-p 22, 25, ..`
	- `--top-ports = 10`
	- `-p-` : all ports
	- `-F` : top 100 ports
- Tracing packets
	- `--packet-trace`
	- `-Pn` (disable icmp echo requests)
	- `-n` (disable DNS resolution)
	- `--disable-arp-ping` (disable arp ping scan)
- Connect scan
	- `-sT` 
	- uses full 3 way handshake
	- not so secure
- Stealth scan
	- `-sC`
- Filtered ports
	- if shown as filtered, may be because of firewall
	- to track handling
		- see above. packet trace, disable icmp, dns and arp
	- if we that duration of scan is much longer, ie. its rejected slowly, may consider firewall there
- UDP ports
	- `-sU`
	- much slower
- Version scan
	- -`-sV


## Saving the results
- 3 diff types of outputs
	- `-oN` normal
	- `-oG` grepable
	- `-oX` xml
	- -`oA` ALL OF THE ABOVE

## Service detection
- Recommended to do quick port scan first, then do service scan on the specific ones
- `-sV` 
- Banner grabbing
	- Sometimes nmap misses things. Try other ways
		- tcpdump
			- `sudo tcpdump -i eth0 host 10.10.14.2`
		- nc
			- `nc -nv 1012.2.28.25`

## Nmap Scripting Engine (NSE)
Types
- default scripts
	- `-sC`
- specific scripts
	- `--script <category>`
- defined scripts
	- `--script <script-name>, <script-name>,..`

